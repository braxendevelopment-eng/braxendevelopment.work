<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quarter Club - Braxen Development</title>
  <link rel="stylesheet" href="style.css">
</head>
<body style="background:#000;color:#fff;font-family:Arial,sans-serif;line-height:1.6;">

<header>
  <nav style="background:#111;padding:12px 20px;border-bottom:1px solid #222;">
    <ul style="list-style:none;display:flex;gap:20px;margin:0;padding:0;">
      <li><a href="index.html" style="color:#fff;text-decoration:none;">Home</a></li>
      <li><a href="quarterclub.html" style="color:#0af;text-decoration:none;">Quarter Club</a></li>
      <li><a href="terms.html" style="color:#fff;text-decoration:none;">Terms</a></li>
    </ul>
  </nav>
</header>

<main style="padding:20px; max-width:900px; margin:auto;">

  <section>
    <h1>Quarter Club Subscription</h1>
    <p>The Quarter Club is designed to help businesses start small. The lowest subscription begins at <strong>$0.25/month</strong>.</p>
    <p>For $10, you can access the <strong>Path to Profit Handbook</strong>, providing financial literacy tools to grow your business. You can also purchase a Quarter Club subscription plus the handbook for $25, which comes with an NDA and business development guidance.</p>
    <p>Braxen Development provides solutions to help businesses build a strong foundation, establish credibility, and prepare for future growth.</p>
  </section>

  <section style="margin-top:30px;">
    <h2>Choose Your Tier & Payment</h2>
    <form id="purchaseForm">
      <label for="tier">Select Tier:</label>
      <select name="tier" id="tier" required>
        <option value="">--Choose--</option>
        <option value="Founders Circle">Founders’ Circle ($0.25/year)</option>
        <option value="Dollar Bill">Dollar Bill ($1/year)</option>
        <option value="Bread & Butter">Bread & Butter ($2/year)</option>
        <option value="Startup Lane">Startup Lane ($5/month)</option>
        <option value="Builder’s Foundation">Builder’s Foundation ($10/month)</option>
        <option value="Growth Track">Growth Track ($20/month)</option>
        <option value="Pro Business">Pro Business ($50/month)</option>
        <option value="Executive Class">Executive Class ($100/month)</option>
      </select>

      <label for="paymentType">Payment Type:</label>
      <select name="paymentType" id="paymentType" required>
        <option value="">--Choose--</option>
        <option value="paypal">PayPal</option>
        <option value="crypto">Crypto</option>
        <option value="cash">Cash</option>
      </select>
    </form>
  </section>

  <!-- PayPal Section -->
  <section id="paypalSection" style="display:none; margin-top:20px;">
    <h3>Pay via PayPal</h3>
    <div id="paypalButtons"></div>
  </section>

  <!-- Crypto Payment Helper -->
  <div id="cryptoHelp" style="display:none; margin-top:20px; background:#0b0b0b; padding:12px; border-radius:8px;">
    <h3 style="margin:0 0 8px 0;">Crypto Payment (Polygon USDC)</h3>
    <p style="margin:0 0 8px 0;">Send <strong id="cryptoAmount">0</strong> USDC on <strong>Polygon (PoS) Mainnet</strong> to the address below. Paste the transaction hash into the Verify form to complete verification.</p>

    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      <div id="qrWrap">
        <img id="cryptoQR" src="" alt="QR code" style="width:180px;height:180px;border-radius:8px;background:#fff;padding:6px;" />
      </div>

      <div style="min-width:220px;">
        <label style="display:block; font-size:13px; color:#ccc; margin-bottom:6px;">Send USDC (Polygon) to:</label>
        <div style="background:#111;padding:10px;border-radius:6px;word-break:break-all;">
          <code id="walletAddress" style="color:#fff; font-family:monospace;">Loading...</code>
        </div>
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button id="copyAddressBtn" type="button" style="padding:8px;border-radius:6px;border:none;background:#222;color:#fff;cursor:pointer;">Copy address</button>
          <button id="openWalletBtn" type="button" style="padding:8px;border-radius:6px;border:none;background:#222;color:#fff;cursor:pointer;">Open in wallet</button>
        </div>
        <p style="margin-top:10px; font-size:13px; color:#bbb;">
          Recommended wallets: MetaMask, Coinbase Wallet. Select <strong>Polygon (Matic) Mainnet</strong> and send USDC. Do not send tokens on other networks.
        </p>
      </div>
    </div>

    <p style="margin-top:8px; font-size:13px; color:#bbb;">
      After sending, copy the transaction hash (tx hash) from your wallet and paste it into the <em>Verify Crypto Payment</em> form.
    </p>
  </div>

  <!-- Cash Section -->
  <section id="cashSection" style="display:none; margin-top:20px;">
    <h3>Cash Payment</h3>
    <p>You will receive a transaction code after your payment is received. Enter it in the verification form to confirm payment.</p>
  </section>

</main>

<footer style="background:#111;padding:12px 20px;margin-top:40px;">
  <p>Contact: <a href="mailto:support@braxendevelopment.work" style="color:#0af;">support@braxendevelopment.work</a></p>
</footer>

<script>
  const tierToUSDC = {
    'Founders Circle': 0.25,
    'Dollar Bill': 1,
    'Bread & Butter': 2,
    'Startup Lane': 5,
    "Builder’s Foundation": 10,
    'Growth Track': 20,
    'Pro Business': 50,
    'Executive Class': 100
  };

  const paymentTypeSelect = document.getElementById('paymentType');
  const tierSelect = document.getElementById('tier');
  const paypalSection = document.getElementById('paypalSection');
  const cryptoHelp = document.getElementById('cryptoHelp');
  const cashSection = document.getElementById('cashSection');
  const cryptoAmountEl = document.getElementById('cryptoAmount');
  const walletAddressEl = document.getElementById('walletAddress');
  const cryptoQREl = document.getElementById('cryptoQR');
  const copyBtn = document.getElementById('copyAddressBtn');
  const openWalletBtn = document.getElementById('openWalletBtn');

  let POLYGON_ADDRESS = "";

  async function fetchPolygonAddress() {
    try {
      const res = await fetch("/get-polygon-address");
      const data = await res.json();
      POLYGON_ADDRESS = data.polygonWalletAddress;
      updateCryptoUI();
    } catch (err) {
      console.error("Failed to load Polygon address:", err);
    }
  }

  function updateCryptoUI() {
    const paymentType = paymentTypeSelect.value;
    paypalSection.style.display = paymentType === 'paypal' ? 'block' : 'none';
    cryptoHelp.style.display = paymentType === 'crypto' ? 'block' : 'none';
    cashSection.style.display = paymentType === 'cash' ? 'block' : 'none';

    if (paymentType === 'crypto') {
      const tier = tierSelect.value;
      const amount = tierToUSDC[tier] ?? 0;
      cryptoAmountEl.innerText = amount.toFixed(2);

      const qrUrl = `https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=${encodeURIComponent(POLYGON_ADDRESS)}`;
      cryptoQREl.src = qrUrl;
      walletAddressEl.textContent = POLYGON_ADDRESS;
    }
  }

  paymentTypeSelect?.addEventListener('change', updateCryptoUI);
  tierSelect?.addEventListener('change', updateCryptoUI);

  copyBtn?.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(POLYGON_ADDRESS);
      alert('Address copied to clipboard');
    } catch {
      alert('Copy failed — long press and copy manually.');
    }
  });

  openWalletBtn?.addEventListener('click', () => {
    window.location.href = `ethereum:${POLYGON_ADDRESS}`;
  });

  fetchPolygonAddress();
    </script>
    <!-- EIN / Business Info Section -->
<section id="businessFormSection" style="display:none; margin-top:30px;">
  <h2>Business Information</h2>
  <form id="businessForm">
    <label for="businessName">Business Name:</label>
    <input type="text" id="businessName" placeholder="Business Name" required style="width:100%;padding:8px;margin-bottom:10px;">

    <label for="businessEIN">Business EIN:</label>
    <input type="text" id="businessEIN" placeholder="XX-XXXXXXX" maxlength="10" required style="width:100%;padding:8px;margin-bottom:10px;">
    <span id="einError" style="color:red; display:none;">Invalid EIN (XX-XXXXXXX)</span>

    <label for="businessEmail">Business Email:</label>
    <input type="email" id="businessEmail" placeholder="example@business.com" required style="width:100%;padding:8px;margin-bottom:10px;">

    <label for="businessPhone">Business Phone:</label>
    <input type="tel" id="businessPhone" placeholder="(123) 456-7890" required style="width:100%;padding:8px;margin-bottom:10px;">

    <label for="businessAddress">Business Address:</label>
    <input type="text" id="street" placeholder="Street Address" required style="width:100%;padding:8px;margin-bottom:10px;">
    
    <div style="display:flex;gap:10px;">
      <select id="state" required style="flex:1;padding:8px;">
        <option value="">Select State</option>
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
      </select>
      <input type="text" id="city" placeholder="City" required style="flex:1;padding:8px;">
      <input type="text" id="zip" placeholder="Zip Code" required style="flex:1;padding:8px;">
    </div>

    <button type="submit" style="margin-top:12px;padding:10px 15px;background:#0af;color:#000;border:none;border-radius:5px;cursor:pointer;">Submit Business Info</button>
    <span id="serverError" style="color:red; display:none;"></span>
  </form>
</section>

<script>
  // Show business form only after tier is selected
  const businessSection = document.getElementById('businessFormSection');
  const tierDropdown = document.getElementById('tier');

  tierDropdown.addEventListener('change', () => {
    if (tierDropdown.value) {
      businessSection.style.display = 'block';
    } else {
      businessSection.style.display = 'none';
    }
  });

  // EIN formatting & validation
  const einInput = document.getElementById('businessEIN');
  const einError = document.getElementById('einError');
  einInput.addEventListener('input', function() {
    let val = this.value.replace(/\D/g,'').slice(0,9);
    if(val.length>2) this.value = val.slice(0,2) + '-' + val.slice(2);
    else this.value = val;
  });

  const businessForm = document.getElementById('businessForm');
  businessForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    einError.style.display = 'none';
    const einVal = einInput.value;
    if(!/^\d{2}-\d{7}$/.test(einVal)){
      einError.style.display = 'inline';
      einInput.focus();
      return;
    }

    // Submit to Worker endpoint
    try {
      const response = await fetch("/submit-business-info", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
          businessName: document.getElementById('businessName').value,
          businessEIN: einVal,
          businessEmail: document.getElementById('businessEmail').value,
          businessPhone: document.getElementById('businessPhone').value,
          street: document.getElementById('street').value,
          city: document.getElementById('city').value,
          state: document.getElementById('state').value,
          zip: document.getElementById('zip').value,
          tier: tierDropdown.value,
          paymentType: document.getElementById('paymentType').value
        })
      });
      const result = await response.json();
      if(response.ok) {
        alert('Business info submitted successfully. Transaction ID: ' + result.txnId);
        businessForm.reset();
        businessSection.style.display='none';
      } else {
        document.getElementById('serverError').innerText = result.error || 'Submission failed.';
        document.getElementById('serverError').style.display='inline';
      }
    } catch(err) {
      document.getElementById('serverError').innerText = 'Network error. Try again later.';
      document.getElementById('serverError').style.display='inline';
    }
  });
</script>
